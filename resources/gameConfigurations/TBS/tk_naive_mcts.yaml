GameConfig:
    Type: TBS
    ActionTimer: 10s
    RoundLimit: 100
    FogOfWar: false

Agents:
#    - HumanAgent
#    - MCTSAgent:
#        Budget: ITERATIONS
#        Iterations: 500
#        RolloutLength: 30
#        ContinuePreviousSearch: false
    - NaiveMCTSAgent:
        Budget: FMCALLS
        MaxFmCalls: 5000
        RolloutLength: 20
        Epsilon_0: 0.7
        Epsilon_G: 0.0
        Epsilon_L: 0.7
        MaxDepth: 2
        ContinuePreviousSearch: false
        K: 0.1
#    - UnitMCTSAgent:
#        Budget: FMCALLS
#        DoStateAbstraction: false
#        MaxFmCalls: 5000
#        RolloutLength: 10
#        ContinuePreviousSearch: false
#        K: 0.1
    - MCTSAgent:
        Budget: FMCALLS
        Iterations: 10000
        MaxFmCalls: 5000
        RolloutLength: 20
        ContinuePreviousSearch: false
        K: 0.1
#    - BasicTBSAgent
#    - RandomAgent
#    - DoNothingAgent
#    - RandomAgent
#    - DoNothingAgent

Board:
    GenerationType: Manual
    Layout: |-
        M  M  M  M  M  M  M  M  M  M  M
        M  .  c1 .  .  .  .  .  .  .  M
        M  .  k1 . F  .  .  .  .  .  M
        M  .  .  .  .  g  .  .  .  .  M
        M  .  .  .  .  .  .  M  .  .  M
        M  .  M  M  .  .  .  .  .  .  M
        M  .  .  .  .  .  .  .  .  .  M
        M  .  .  .  .  g  .  M  .  .  M
        M  .  k0 .  F  .  .  .  .  .  M
        M  .  c0 .  .  .  .  .  .  .  M
        M  M  M  M  M  M  M  M  M  M  M

GameRenderer:
    Resolution:
        Width: 800
        Height: 600
    Default Assets:
        Selected: ../../assets/Tiles/selected.png
        FogOfWar: ../../assets/Tiles/notVisible.png
    #Optional:
    #Font: ../../assets/arial.ttf
    #OutlineShader: ../../assets/OutLine.frag

Player:
#    Actions: [Build, Research, PlayerEmpty]
#    Actions: [PlayerEmpty]
#    CanSpawn: Buildings
    Parameters:
        Gold: [0,0,1000]
        Prod: [0,50,100]
        Score: [0,0,1000]
        MovementPoints: [0,5,5]

Tiles:
    Plain:
        Sprite: ../../assets/Tiles/plain.png
        Symbol: .
        IsWalkable: true
        DefaultTile: true
    Water:
        Sprite: ../../assets/Tiles/water.png
        Symbol: W
        IsWalkable: false
    Mountain:
        Sprite: ../../assets/Tiles/rock.png
        Symbol: M
        IsWalkable: false
        BlocksSight: true
    Forest:
        Sprite: ../../assets/Tiles/forest.png
        Symbol: F
        IsWalkable: true

Entities:
    City:
        Sprite: ../../assets/Entities/castle.png
        Symbol: c
        LineOfSightRange: 5
#        Actions: [Build, Spawn, Research,Empty]
        Actions: [Spawn, Empty]
#        Actions: [Empty]
#        Actions: [Empty]
#        CanSpawn: [Worker, Buildings]
        CanSpawn: [Worker, Warrior]
        Cost:
            Prod: 10
        Parameters:
            Health: 200
            StorageCapacity: 50
            WeaponStrength: 50
            Range: 6
            MovementPoints: [0,1,1]

    Barracks:
        Sprite: ../../assets/Entities/barracks.png
        Symbol: b
        LineOfSightRange: 3
        RequiredTechnology: Discipline
        Actions: [Spawn, Empty]
        CanSpawn: [Warrior, Archer]
        Cost:
            Prod: 3
        Parameters:
            Health: 100
            Range: 6
            MovementPoints: [0,1,1]

    MilitaryAcademy:
        Sprite: ../../assets/Entities/military.png
        LineOfSightRange: 3
        RequiredTechnology: Mathematics
        Actions: [Spawn, Empty]
        CanSpawn: [Catapult]
        Cost:
            Prod: 40
        Parameters:
            Health: 100
            MovementPoints: [0,1,1]

    Foundry:
        Sprite: ../../assets/Entities/foundry.png
        LineOfSightRange: 2
        RequiredTechnology: Metallurgy
        Actions: []
        Cost:
            Prod: 50
        Parameters:
            Health: 50
            MovementPoints: [0,1,1]
            
    Workshop:
        Sprite: ../../assets/Entities/storage.png
        LineOfSightRange: 2
        RequiredTechnology: Apprenticeship
        Actions: []
        Cost:
            Prod: 50
        Parameters:
            Health: 50
            MovementPoints: [0,1,1]

    Storage:
        Sprite: ../../assets/Entities/castle.png
        LineOfSightRange: 1
        RequiredTechnology: Pottery
        Actions: []
        Cost:
            Prod: 40
        Parameters:
            Cost: 40
            Health: 50
            StorageCapacity: 50
            MovementPoints: [0,1,1]

    Worker:
        Sprite: ../../assets/Entities/unit_5.png
        Symbol: w
        LineOfSightRange: 3
        Actions: [Move, Mine, Empty]
        Cost:
            Prod: 50
        Time: 5
        Parameters:
            ResourceCapacity: 10
            Armor: 5
            Speed: 1
            WeaponStrength: 5
            Health: 30
            Range: 3
            MovementPoints: [0,1,1]
            
    Warrior:
        Sprite: ../../assets/Entities/unit_2.png
        Symbol: o
        LineOfSightRange: 3
        Actions: [Move, Attack, Empty]
        # RequiredTechnology: BronzeWorking # for simplify it a little bit
        Cost:
            Gold: 40
        Parameters:
            Armor: 20
            Speed: 1
            Range: 1.5
            WeaponStrength: 70
            Morale: 10
            Health: 100
            MovementPoints: [0,1,1]
    King:
        Sprite: ../../assets/Entities/unit_1.png
        Symbol: k
        LineOfSightRange: 3
        Actions: [Move, Attack, Empty]
        # RequiredTechnology: BronzeWorking # for simplify it a little bit
        Cost:
            Gold: 40
        Parameters:
            Armor: 20
            Speed: 1
            Range: 1.5
            WeaponStrength: 50
            Morale: 10
            Health: 200
            MovementPoints: [0,1,1]

    Archer:
        Sprite: ../../assets/Entities/unit_3.png
        LineOfSightRange: 3
        Actions: [Move, Attack, Empty]
        RequiredTechnology: Archery
        Cost:
            Prod: 3
        Parameters:
            Armor: 15
            Speed: 1
            Range: 6
            WeaponStrength: 15
            ReloadTime: 2
            Morale: 10
            Health: 30
            MovementPoints: [0,1,1]

    Catapult:
        Sprite: ../../assets/Entities/unit_4.png
        LineOfSightRange: 3
        Actions: [Move, Attack, Empty]
        RequiredTechnology: Engineering
        Cost:
            Prod: 5
        Parameters:
            Armor: 10
            Speed: 1
            Range: 15
            WeaponStrength: 40
            ReloadTime: 3
            Morale: 5
            Health: 60
            MovementPoints: [0,1,1]

    GoldVein:
        Sprite: ../../assets/Entities/gold_chest.png
        Symbol: g
        LineOfSightRange: 6
        Actions: []
        Parameters:
            Gold: 120
            PlayerAMined: [0,0,1000]
            PlayerBMined: [0,0,1000]
            MovementPoints: [0,1,1]

EntityGroups:
    Units: [Worker, Warrior, Archer, Catapult, King]
#    Buildings: [City, Barracks, MilitaryAcademy, Foundry, Workshop, Storage]
    Buildings: [Barracks, MilitaryAcademy, Foundry, Workshop, Storage]
    Attackable: [City, Barracks, MilitaryAcademy, Foundry, Workshop, Storage, Worker, Warrior, Archer, Catapult, King]

Actions:
    # Attack Actions
    Attack:
        Type: EntityAction
        Cooldown: 1
        Targets:
            Target:
                Type: Entity
                ValidTargets: Attackable
                SamplingMethod:
                    Type: Neighbours
                    Options:
                        Shape: AllPositions
                Conditions:
                    - "DifferentPlayer(Source, Target)"
                    - "InRange(Source, Target, Source.Range)"
        Effects:
            - "Attack(Target.Health, Source.WeaponStrength)"

    Move:
        Type: EntityAction
        Preconditions:
            - "ResourceGreaterEqual(Source.MovementPoints, 1)"
        Cooldown: 1
        Targets:
            Target:
                Type: Position
                SamplingMethod: 
                    Type: Neighbours
                    Options:
                        Shape: Square
                        Size: 1
                #    Type: Neighbours
                #    Options:
                #        Shape: Circle
                #        Size: 1
                Conditions:
                    - "IsWalkable(Target)"
        Effects:
            - "Move(Source, Target)"
            - "SetToMinimum(Source.MovementPoints)"

    Research:
        Type: EntityAction
        Cooldown: 0
        Preconditions:
            - "ResourceGreaterEqual(Source.MovementPoints, 1)"
        Targets:
            Target:
                Type: Technology
                ValidTargets: All  
                Conditions:
                    - "CanResearch(Source.Player, Target)"
                    - "CanAfford(Source.Player, Target)"
        TriggerComplete:
            - "HasElapsedTick(Target.Time)"
        OnStart:
            - "PayCost(Source.Player, Target)"
        OnComplete:
            - "Research(Source.Player, Target)"
            - "ModifyResource(Source.Player.Score, 10)"
            - "ModifyResource(Source.MovementPoints, -1)"

    Mine:
        Type: EntityAction
        Cooldown: 1
        Targets:
            Target:
                Type: Entity
                ValidTargets: GoldVein
                SamplingMethod: 
                    Type: Neighbours
                    Options:
                        Shape: Circle
                        Size: 1
                Conditions:
                    - "ResourceGreaterEqual(Target.Gold, 40)"
        Effects:
            - "Transfer(Target.Gold, Source.Player.Gold, 40)"
            - "RecordMinedGold(Source.Player, Target.PlayerAMined, Target.PlayerBMined, 40)"
            - "Attack(Source.Health, 12"
#            - "ModifyResource(Source.Health, -12)"

    #Spawn
    Spawn:
        Type: EntityAction
        Cooldown: 0
        Targets:
            EntityTypeTarget:
                Type: EntityType
                ValidTargets: Units
                Conditions:
                    - "CanSpawn(Source, EntityTypeTarget)"
                    - "CanAfford(Source.Player, EntityTypeTarget)"
            TargetPosition:
                Type: Position
                SamplingMethod: 
                    Type: Neighbours
                    Options:
                        Shape: Square
#                        Shape: Circle
                        Size: 1
                Conditions:
                    - "IsWalkable(TargetPosition)"

        Effects:
            - "SpawnEntity(Source, EntityTypeTarget, TargetPosition)"
            - "PayCost(Source.Player, EntityTypeTarget)"
            - "ModifyResource(Source.Player.Score, 2)"

    #Build
    Build:
#        Type: PlayerAction
        Type: EntityAction
        Preconditions:
            - "ResourceGreaterEqual(Source.MovementPoints, 1)"
        Cooldown: 1
        Targets:
            EntityTypeTarget:
                Type: EntityType
                ValidTargets: Buildings
                Conditions:
                    - "CanAfford(Source.Player, EntityTypeTarget)"
                    - "CanSpawn(Source, EntityTypeTarget)"
#                    - "CanAfford(Source.Player, EntityTypeTarget)"
#                    - "CanSpawn(Source, EntityTypeTarget)"

            TargetPosition:
                Type: Position
                SamplingMethod:
                    Type: Neighbours
                    Options:
#                        Shape: AllPositions
                        Shape: Circle
                        Size: 2
                Conditions:
                    - "IsWalkable(TargetPosition)"

        Effects:
            - "SpawnEntity(Source.Player, EntityTypeTarget, TargetPosition)"
            - "PayCost(Source.Player, EntityTypeTarget)"
            - "ModifyResource(Source.Player.Score, 5)"
            - "ModifyResource(Source.MovementPoints, -1)"

    Empty:
        Type: EntityAction
        Preconditions:
            - "ResourceGreaterEqual(Source.MovementPoints, 1)"
        Effects:
            - "ModifyResource(Source.MovementPoints, -1)"

    PlayerEmpty:
        Type: PlayerAction
        Cooldown: 1
        Preconditions:
            - "ResourceGreaterEqual(Source.MovementPoints, 1)"
        Effects:
#            - "ModifyResource(Source.MovementPoints, -1)"
            - "SetToMinimum(Source.MovementPoints)"

TechnologyTrees:
    SingleTree:
        Mining:
            Description: Base technology
            Cost:
                Prod: 2
            Time: 2
        Discipline:
            Description: Enables barracks construction.
            Requirements: [Mining]
            Cost:
                Prod: 3
            Time: 2
        Pottery:
            Description: Allows to construct a Storage.
            Requirements: [Mining]
            Cost:
                Prod: 3
            Time: 2
        Mathematics:
            Description: Here you can build a military academy
            Requirements: [Mining]
            Cost:
                Prod: 3
            Time: 2
        Archery:
            Description: Here you can spawn archers.
            Requirements: [Discipline]
            Cost:
                Gold: 5
            Time: 3
        BronzeWorking:
            Description: Here you can spawn warriors.
            Requirements: [Discipline]
            Cost:
                Gold: 5
            Time: 3
        Apprenticeship:
            Description: Here you can build a workshop.
            Requirements: [Pottery]
            Cost:
                Gold: 5
            Time: 3
        Metallurgy:
            Description: Here you can build a foundry.
            Requirements: [Apprenticeship]
            Cost:
                Gold: 5
            Time: 5
        Engineering:
            Description: Here you can spawn a catapult.
            Requirements: [Mathematics]
            Cost:
                Gold: 5
            Time: 3
            
                   
ForwardModel:

    LoseConditions: #If true: Player -> cant play
        HasNoCity:
        - "HasNoEntity(Source, King)"
#        - "HasNoEntity(Source, City)"

    Trigger:
        - OnTick:
            Type: Entity
            ValidTargets: City
            Conditions:
                - "IsPlayerEntity(Source)"
            Effects:
                - "ModifyResource(Source.Player.Prod, 1)"
        - OnTick:
            Type: Entity
            ValidTargets: Workshop
            Conditions:
                - "IsPlayerEntity(Source)"
            Effects:
                - "ModifyResource(Source.Player.Prod, 2)"
        - OnTick:
            Type: Entity
            ValidTargets: Foundry
            Conditions:
                - "IsPlayerEntity(Source)"
                - "ResourceGreaterEqual(Source.Player.Gold, 2)"
            Effects:
                - "ModifyResource(Source.Player.Gold, -2)"
                - "ModifyResource(Source.Player.Prod, 4)"
        - OnTick:
            Type: Entity
            Effects:
                - "SetToMaximum(Source.MovementPoints)"
        - OnTick:
            Type: Player
            Effects:
                - "SetToMaximum(Source.MovementPoints)"

#Game Description
GameDescription:
    Type: CombatGame
    Actions:
        Move: [Move]
        Research: [Research]
        Gather: [Mine]
        Spawn: [Spawn, Build]
        Attack: [Attack]
    Entities:
        Base: [City]
        Building: [City, Barracks, MilitaryAcademy, Foundry, Workshop, Storage]
        Spawner: [City, Barracks, MilitaryAcademy]
        Unit: [Worker, Warrior, Archer, Catapult, King]
        Fighter: [Warrior, Archer, Catapult]
        NoFighter: [Worker]
        Melee: [Warrior]
        Ranged: [Archer, Catapult]