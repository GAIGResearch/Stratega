GameConfig:
    Type: TBS
    RoundLimit: 100
    FogOfWar: true

Agents:
    - HumanAgent
    - OSLAAgent

Player:
    Actions: [Research]
    #CanSpawn: Buildings
    Parameters:
        Score: [0,0,10000]
        Stars: [0,4,10000]

GameRenderer:
    Resolution:
        Width: 800
        Height: 600
    Default Assets:
        FogOfWar: ../../../assets/Tiles/notVisible.png
    GridIsIsometric: true
    TileSpriteOrigin:
        Width: 128
        Height: 112
    EntitySpriteOrigin:
        Width: 256
        Height: 360
    TileSpriteSize:
        Width: 256
        Height: 144
    EntitySpriteSize:
        Width: 512
        Height: 512
    #Optional:
    #Font: ../../assets/arial.ttf
    #OutlineShader: ../../assets/OutLine.frag

Tiles:
    Plain:
        Sprite: ../../../assets/Tiles/plain.png
        Symbol: .
        IsWalkable: true
        DefaultTile: true
    Water:
        Sprite: ../../../assets/Tiles/water.png
        Symbol: W
        IsWalkable: true
    Ocean:
        Sprite: ../../../assets/Tiles/water.png
        Symbol: O
        IsWalkable: true
    Mountain:
        Sprite: ../../../assets/Tiles/rock.png
        Symbol: M
        IsWalkable: true
    Forest:
        Sprite: ../../../assets/Tiles/forest.png
        Symbol: F
        IsWalkable: true
        
Board:
    GenerationType: Manual
    Layout: |-
        .  .  .  .  .  .  .  .  .
        .  .  .  .  .  .  .  c1 .
        W  W  .  .  .  .  .  .  .
        .  W  .  .  .  .  .  .  .
        .  W  .  .  .  .  .  .  .
        .  W  W  .  .  .  .  .  .
        .  .  W  W  .  .  .  .  .
        .  .  .  W  W  W  W  .  .
        .  a  .  .  W  .  W  W  .
        .  M  c0 .  W  .  .  W  W
        .  M  a  .  W  .  .  .  .
        a  .  .  W  W  .  .  .  .
        .  .  .  W  .  .  .  .  .
        W  W  W  W  .  .  .  .  .
        .  .  .  .  .  .  .  .  .
        .  .  .  .  .  .  .  .  .
        .  .  .  .  .  .  .  .  .
Actions:
    Spawn:
        Type: EntityAction
        Cooldown: 0
        Targets:
            EntityTypeTarget:
                Type: EntityType
                ValidTargets: Units
                Conditions:
                    - "CanSpawn(Source, EntityTypeTarget)"
                    - "CanAfford(Source.Player, EntityTypeTarget)"

            TargetPosition:
                Type: Position
                SamplingMethod: 
                    Type: Neighbours
                    Options:
                        Shape: Square
                        Size: 0
                Conditions:
                    - "IsWalkable(TargetPosition)"
                    - "IsTileType(TargetPosition, Plain)"

        Effects:
            - "SpawnEntity(Source, EntityTypeTarget, TargetPosition)"
            - "PayCost(Source.Player, EntityTypeTarget)"
    BuildPort:
        Type: EntityAction
        Cooldown: 0
        Targets:
            EntityTypeTarget:
                Type: EntityType
                ValidTargets: Port
                Conditions:
                    - "CanSpawn(Source, EntityTypeTarget)"
                    - "CanAfford(Source.Player, EntityTypeTarget)"
            TargetPosition:
                Type: Position
                SamplingMethod:
                    Type: Neighbours
                    Options:
                        Shape: AllPositions
                Conditions:
                    - "IsWalkable(TargetPosition)"
                    - "IsTileType(TargetPosition, Water)"
                    - "InRange(Source, TargetPosition, Source.Border)"

        Effects:
            - "SpawnEntity(Source, EntityTypeTarget, TargetPosition)"
            - "PayCost(Source.Player, EntityTypeTarget)"

    #Harvest resources
    Hunt:
        Type: EntityAction
        Cooldown: 0
        Preconditions:
            - "HasResearched(Source.Player, Hunting)"
            - "ResourceGreaterEqual(Source.Player.Stars, 2)"
        Targets:
            Target:
                Type: Entity
                ValidTargets: Animals
                SamplingMethod:
                    Type: Neighbours
                    Options:
                        Shape: AllPositions
                Conditions:
                - "InRange(Source, Target, Source.Border)"
        Effects:
            - "Remove(Target)"
            - "ModifyResource(Source.Player.Score, 10)"
            - "ModifyResource(Source.Population, 1)"
            - "ModifyResource(Source.Player.Stars, -2)"

    Upgrade2:
        Type: EntityAction
        Cooldown: 1
        Preconditions:
            - "ResourceGreaterEqual(Source.Population, Source.ToUpgrade)"
        Targets:
            EntityTypeTarget:
                Type: EntityType
                ValidTargets: CityLevel2
        Effects:
            - "Remove(Source)"
            - "SpawnEntity(Source.Player, EntityTypeTarget, Source)"
    Upgrade3:
        Type: EntityAction
        Cooldown: 1
        Preconditions:
            - "ResourceGreaterEqual(Source.Population, Source.ToUpgrade)"
        Targets:
            EntityTypeTarget:
                Type: EntityType
                ValidTargets: CityLevel3
        Effects:
            - "Remove(Source)"
            - "SpawnEntity(Source.Player, EntityTypeTarget, Source)"

    Move:
        Type: EntityAction
        Preconditions:
            - "ResourceGreaterEqual(Source.Movement, 1)"
        Targets:
            Target:
                Type: Position
                SamplingMethod:
                    Type: Neighbours
                    Options:
                        Shape: AllPositions
                Conditions:
                    - "IsWalkable(Target)"
                    - "IsTileType(Target, Plain)"
                    - "InRange(Source, Target, Source.Range)"
        Effects:
            - "Move(Source, Target)"
            - "ModifyResource(Source.Movement, -1)"
    Climb:
        Type: EntityAction
        Preconditions:
            - "HasResearched(Source.Player, Climbing)"
            - "ResourceGreaterEqual(Source.Movement, 1)"
        Targets:
            Target:
                Type: Position
                SamplingMethod:
                    Type: Neighbours
                    Options:
                        Shape: AllPositions
                Conditions:
                    - "IsWalkable(Target)"
                    - "IsTileType(Target, Mountain)"
                    - "InRange(Source, Target, Source.Range)"
        Effects:
            - "Move(Source, Target)"
            - "ModifyResource(Source.Movement, -1)"

    Research:
        Type: PlayerAction
        Cooldown: 0
        Targets:
            Target:
                Type: Technology
                ValidTargets: All  
                Conditions:
                    - "CanResearch(Source, Target)"
                    - "CanAfford(Source, Target)"
        Effects:
            - "PayCost(Source, Target)"
            - "Research(Source, Target)"
            - "ModifyResource(Source.Score, 10)"
            

            
Entities:
    Warrior:
        Sprite: ../../../assets/Entities/unit_2.png
        Symbol: w
        LineOfSightRange: 6
        Actions: [Move, Climb]
        Cost:
            Stars: 2
        Parameters:
            Level: 0
            Health: 10
            Attack: 2
            Defence: 2
            Movement: 1
            Range: 1

            #Kills to level
            Kill: 3
    Defender:
        Sprite: ../../../assets/Entities/unit_2.png
        Symbol: w
        LineOfSightRange: 6
        Actions: [Move, Climb]
        RequiredTechnology: Shields
        Cost:
            Stars: 3
        Parameters:
            Level: 0
            Health: 15
            Attack: 1
            Defence: 3
            Movement: 1
            Range: 1

            #Kills to level
            Kill: 3
    Rider:
        Sprite: ../../../assets/Entities/unit_2.png
        Symbol: w
        LineOfSightRange: 6
        Cost:
            Stars: 4
        Actions: [Move, Climb]
        RequiredTechnology: Riding
        Parameters:
            Level: 0
            Health: 10
            Attack: 2
            Defence: 1
            Movement: 2
            Range: 1

            #Kills to level
            Kill: 3

    Animals:
        Sprite: ../../../assets/Entities/animals.png
        Symbol: a
        LineOfSightRange: 1

    Village:
        Sprite: ../../../assets/Entities/storage.png
        Symbol: v
        LineOfSightRange: 1

    Port:
        Sprite: ../../../assets/Entities/masonry.png
        Symbol: p
        LineOfSightRange: 1
        RequiredTechnology: Sailing

    CityLevel1:
        Sprite: ../../../assets/Entities/tower.png
        Symbol: c
        LineOfSightRange: 6
        Actions: [Spawn, BuildPort, Hunt, Upgrade2]
        Parameters:
            Level: 1
            Production: 4
            Population: [0,2,3]
            ToUpgrade: 3

            Border: 2
    CityLevel2:
        Sprite: ../../../assets/Entities/guardTower.png
        Symbol: p
        LineOfSightRange: 6
        Actions: [Spawn, BuildPort, Hunt, Upgrade3]
        Parameters:
            Level: 2
            Production: 5
            Population: [0,3,4]
            ToUpgrade: 4

            Border: 3
    CityLevel3:
        Sprite: ../../../assets/Entities/castle.png
        Symbol: p
        LineOfSightRange: 6
        Actions: [Spawn, BuildPort, Hunt]
        Parameters:
            Level: 2
            Production: 5
            Population: [0,0,5]
            ToUpgrade: 5

            Border: 4
EntityGroups:
    Units: [Warrior, Rider, Defender]
    Buildings: [CityLevel1, CityLevel2, CityLevel3]
    Cities: [CityLevel1, CityLevel2, CityLevel3]
    Resources: [Animals]

Grids:
    BuildingsAndResources: [CityLevel1, CityLevel2, CityLevel3, Animals]
    Units: [Warrior, Rider, Defender]

TechnologyTrees:
    SingleTree:
        Hunting:
            Description: Enable animal hunting.
            Cost:
                Stars: 5
            Time: 0
        Riding:
            Description: Enable riders.
            Cost:
                Stars: 5
            Time: 0

        Organization:
            Description: Enable fruit harvesting.
            Cost:
                Stars: 5
            Time: 0
        Shields:
            Description: Enable shield units.
            Requirements: [Organization]
            Cost:
                Stars: 6
            Time: 0
        Farming:
            Description: Enable farming.
            Requirements: [Organization]
            Cost:
                Stars: 6
            Time: 0
        Construction:
            Description: Enable construction.
            Requirements: [Farming]
            Cost:
                Stars: 6
            Time: 0

        Climbing:
            Description: Enable mountain movement and defense bonus.
            Cost:
                Stars: 5
            Time: 0
        Mining:
            Description: Enable mine.
            Requirements: [Climbing]
            Cost:
                Stars: 6
            Time: 0
        Meditation:
            Description: Enable mountain temple and pacifist.
            Requirements: [Climbing]
            Cost:
                Stars: 6
            Time: 0
        Philosophy:
            Description: Enable Mind blender, Literacy and Genius.
            Requirements: [Meditation]
            Cost:
                Stars: 7
            Time: 0
        Smithery:
            Description: Enable Swordsman and Forge.
            Requirements: [Mining]
            Cost:
                Stars: 7
            Time: 0

        Fishing:
            Description: Enable fishing.
            Cost:
                Stars: 5
            Time: 0
        Whaling:
            Description: Enable whale hunting.
            Requirements: [Fishing]
            Cost:
                Stars: 6
            Time: 0
        Sailing:
            Description: Enable ships, port and movement throught water.
            Requirements: [Fishing]
            Cost:
                Stars: 6
            Time: 0
        Aquatism:
            Description: Enable water temple, defense bonus and defence bonus.
            Requirements: [Whaling]
            Cost:
                Stars: 7
            Time: 0
        Navigation:
            Description: Enable battleship, ocean movement, explorer.
            Requirements: [Sailing]
            Cost:
                Stars: 7
            Time: 0
ForwardModel:
    #LoseConditions: #If true: Player -> cant play
    #    NoHasKing:
    #    - "HasNoEntity(Source, King)"

    Trigger:
        #Restart units movement
        - OnTick:
            Type: Entity
            ValidTargets: Units
            Effects:
                - "SetToMaximum(Source.Movement)"
        - OnTick:
            Type: Entity
            ValidTargets: Cities
            Effects:
                - "ModifyResource(Source.Player.Stars, Source.Production)"
        #Check cities and level up
        #- OnTick:
        #    Type: Entity
        #    ValidTargets: Cities
        #    Conditions:
        #        - "IsPlayerEntity(Source)"
        #        - "ResourceGreaterEqual(Source.Population, Source.ToUpgrade)"
        #    Effects:
        #        - "Remove(Source)"
        #        - "SpawnEntity(Source, "Name", TargetPosition)"

